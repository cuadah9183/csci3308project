<%- include ('../partials/header') %>
<%- include ('../partials/menu') %>
<div class="col"><%- include ('../partials/message') %></div>



<main>
  <script src="/resources/js/script.js"></script>
  <div class="container">
    <h2><%= username %>'s Calendar</h2>
    <p></p>
    <h4 class="text-center">
        <form action="/calendar" method="GET">
           <input type="hidden" id="year" name="year" value=2022 />
            <button name="week" value="<%= parseInt(weeknum)-1 %>" type="submit" class="btn" style="border-color: black;"><</button>  <%= dayrange[0] %> to <%= dayrange[1] %> <button name="week" value="<%= parseInt(weeknum)+1 %>" type="submit" class="btn" style="border-color: black;">></button>
        </form></h4>
    <p></p>
    <div class="container">
        <div id="calendar" class="row" style="column-gap:10px;height: 450px; row-gap:20px">


          <%
          function mealString(item,func){
            return "{recipeid:'"+item.recipeid+"',name:'"+item.name+"',servings:'"+item.servings+"',nutrients: {"+
                                      nutrients.fields.map(func).join(",")+"}}";
          }  
          
          %>

            <% 
              


                const CALENDAR_DAYS = [
                "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"
                ];
    
                var res = '';
                var i;
                for (i = 1; i < 8; i++) {
                  var weekday = {year: year, week: weeknum, day: i};
                  res +=  '<div class="card" style="width:150px; border-color:black;" >'+
                    '<div class="h6 text-center position-relative py-2">'+
                      '<form  action="/home" method="GET" >'+
                        '<input type="hidden" name="week" value="'+ weekday.week +'"/>'+
                        '<input type="hidden" name="day" value="'+ weekday.day +'"/>'+
                        '<input type="hidden" name="year" value="'+ weekday.year +'"/>'+
                        '<button class="btn btn-primary" style="background-color: white; border-color: white; color: black; text-decoration: underline;" type="submit">' + CALENDAR_DAYS[i % 7] + '</button>'+
                      '</form>'+
                    '</div>'+
                  '<div class="meal-container">';
                  if (weeklog){
                    weeklog.forEach(function(item){
                    if (item.day == i % 7){
                      const logMeal=mealString(item,nutr=> nutr+":"+ item.nutrients[nutr]);
                      res += '<button id="view" type="button" class="btn btn-primary" style="width: 125px; background-color: white; border-color: black; color: black; text-align: center; margin-bottom: 2px;" onclick="viewMealModal(' +logMeal+')">' + item.name +'</button>';
                    }

                  });
                }
                  res += '</div></div></form>';
                }%>
              <%- res %>
        
        </div>

    </div>
    <p></p>



  </div>
  %>


<%- include ('../partials/addMeal',{nutrients:nutrients}) %>
</main>

<%- include ('../partials/footer') %>